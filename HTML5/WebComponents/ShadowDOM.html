<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8" />
<title>Shadow DOM</title>
<style type="text/css">
h1{ font-size:24px; font-weight:bold; color:rgb(50,50,250); margin-left:20px;} 
h2{ font-size:18px; font-weight:bold; color:rgb(250,50,150); margin-left:20px;}
h3{ font-size:14px; font-weight:bold; color:rgb(200,20,20); margin-left:20px;}
code, pre{ color:rgb(20,150,30); font-weight:bold; background:rgb(230,230,230); margin:5px; padding:5px;}
tt, em{color:#6a9999}
dt{ color:#003399; margin-bottom:5px;}

p{
margin:10px;
}

.nota{ color:rgb(250,120,0);}
.grigio{color:gray;}
.azzurro{color:rgb(50,100,255);}
.scuro{color:#333;}

</style>
</head>
<body>

<h1>Shadow DOM</h1>

<p>
Lo <q>Shadow Dom</q> è un albero aggiunto all'albero del DOM. Lo Shadow dom può essere associato ad un elemento  senza che diventi un suo nodo perchè esso è separato dal documento. <br />
Lo Shadow Dom può essere applicato ad un elemento tramite il metodo <b>createShadowRoot</b>; questo restituisce un nodo <b>ShadowRoot</b> che può essere popolato da altri nodi. Un elemento a cui è applicato lo Shadow dom è detto <b>shadow host</b>.
</p>
<p>
Poniamo il caso di avere un markup di questo tipo:
<pre>
&lt;style&gt; 
.outer {
  border: 2px solid brown;
  border-radius: 1em;
  background: red;
  font-size: 20pt;
  width: 12em;
  height: 7em;
  text-align: center;
}
.boilerplate {
  color: white;
  font-family: sans-serif;
  padding: 0.5em;
}
.name {
  color: black;
  background: white;
  font-family: "Marker Felt", cursive;
  font-size: 45pt;
  padding-top: 0.2em;
}
&lt;/style&gt; 
<span class="azzurro">
&lt;div class="outer"&gt; 
	&lt;div class="boilerplate"&gt; 
		Hi! My name is
	&lt;/div&gt; 
	&lt;div class="name"&gt; 
		Bob
	&lt;/div&gt; 
&lt;/div&gt; </span>
</pre>
Potremmo inserire tutto in un template ma prima creando un div ('nameTag') che specifica, in questo caso, un nome:
<pre>
<span class="azzurro">
&lt;div id="nameTag"&gt;Bob&lt;/div&gt; 

&lt;template id="nameTagTemplate"&gt; 

	&lt;style&gt; 	
		<span class="nota">uguale a sopra</span>
	&lt;/style&gt; 

	&lt;div class="outer"&gt; 
		&lt;div class="boilerplate"&gt; 
			Hi! My name is
		&lt;/div&gt; 
		&lt;div class="name"&gt; 
			&lt;content&gt;&lt;/content&gt;  
		&lt;/div&gt; 
	&lt;/div&gt;
 
&lt;/template&gt; 
</span>
</pre>
Il tag <q>template</q> (come sappiamo) non è restituito ma con Javascript lo possiamo aggiungere al documento; 
<pre>
&lt;script&gt; 

var shadow = document.querySelector('#nameTag').createShadowRoot();
var template = document.querySelector('#nameTagTemplate');
shadow.appendChild(template.content.cloneNode());
document.querySelector('#nameTag').textContent = 'Shellie';

&lt;/script&gt; 
</pre>
nel &lt;div class='name'&gt; al posto del nome abbiamo inserito il tag &lt;content&gt; che ci permette di proiettare il contenuto del tag con Javascript dinamicamente. ( Nel caso abbiamo inserito il nome 'Shellie' ma si potrebbe anche creare un campo &lt;input&gt; che l'utente possa riempire per inserire il suo nome)  
</p>

<h2>Incapsulamento degli stili</h2>
<p>
Oltre a quello visto nell'esempio sopra, lo <q>Shadow dom</q> permette l'incapsulamento degli stili CSS
<pre>
<span class="azzurro">
&lt;div&gt;
	&lt;h3&gt;Light DOM&lt;/h3&gt;  
&lt;/div&gt; 
</span>
&lt;script&gt; 

var root = document.querySelector('div').createShadowRoot();
root.innerHTML = 
	'&lt;style&gt; h3{ color: red; } &lt;/style&gt; ' + 
	'&lt;h3&gt; Shadow DOM &lt;/h3&gt; ';

&lt;/script&gt; 
</pre>
A seguito di quanto avremo il testo originale sostituito da quello inserito nella <q>shadow root</q> con lo stile (color: red) applicato: pertanto avremo il seguente risultato
</p>

<div><h3>Light DOM</h3></div>
<script type="text/javascript">
var root = document.querySelector('div').createShadowRoot();
root.innerHTML = 
'<style>h3{ color: red; }</style>' + 
'<h3>Shadow DOM</h3>';
</script>

<h2>L'elemento :host</h2>
<p>
L'elemento <q>:host</q> è un riferimento all'elemento <b>Shadow host</b> che ospita lo <b>Shadow tree</b>, pertanto lo possiamo utilizzare per applicargli gli stili CSS.
<pre>
<span class="azzurro">
&lt;button class="red"&gt;Il mio pulsante&lt;/button&gt;  
</span>
&lt;script&gt; 
var button = document.querySelector('button');
var root = button.createShadowRoot();
root.innerHTML = 
	'&lt;style&gt; ' + 
		':host { text-transform: uppercase; }' +
		':host(:hover){opacity: 0.4} ' +	
		':host(:active){position:relative; top:3px; left:3px }' +	
	'&lt;/style&gt; ' +
	'&lt;content&gt; &lt;/content&gt;';
&lt;/script&gt; 
</pre>
Pertanto avremo il seguente risultato:

</p>
<button class="red">My Button</button>

<script type="text/javascript">
var button = document.querySelector('button');
var root = button.createShadowRoot();
root.innerHTML = '<style>' + 
	':host { text-transform: uppercase; }' +
	':host(:hover){opacity: 0.4} ' +	
	':host(:active){position: relative; top:3px; left:3px }' +	
	'</style>' + 
	'<content></content>';
</script>

<h3>:host-context(&lt;selector&gt; )</h3>
<p>
E' una pseudo-classe che fa riferimento all'elemento host sia se esso o il suo primo parente coimncide con <q>selector</q>. Può per esempio essere usato per asssegnare una classe all'elemento &lt;html&gt; o &lt;body&gt; 
<pre>
<span class="azzurro">
&lt;body class="different"&gt; 
	&lt;x-foo&gt;Sono x-foo&lt;/x-foo&gt;  
&lt;/body&gt; 
</span>
<span class="nota">//var root = document.querySelector('body').createShadowRoot();		// va bene anche questo</span>
var root = document.querySelector('x-foo').createShadowRoot();
root.innerHTML = 
	'&lt;style&gt; ' +
	':host-context(.different) { color: red;}' + 
	'&lt;/style&gt; ' +
	'&lt;content&gt;&lt;/content&gt;  ';;
</pre>
</p>

<h3>altri usi di :host</h3>

<pre>
:host(x-foo){
<span class="nota">// quando lo Shadow host è un elemento &lt;x-foo&gt;  </span>
}

:host(x-foo:host){
<span class="nota">// uguale al precedente</span>
}

:host(div) {
<span class="nota">// quando l'host è un elemento &lt;div&gt; </span>
}
</pre>


<h2>::shadow</h2>
<p>
Se un elemento può avere almeno un shadow tree, il pseudo elemento <q>::shadow</q> fa riferimento alla shadow root stessa. Un esempio può essere quello di assegnare degli stili ad un elemento che sta nello shadow tree di un'altro elemento genitore
<pre>
<span class="azzurro">
&lt;div id="host"&gt; 
	&lt;p&gt; paragrafo &lt;/p&gt;  
	&lt;span&gt; Light DOM &lt;/span&gt;  
&lt;/div&gt; 
</span>
var root = document.querySelector('div').createShadowRoot();

root.innerHTML = 
	'&lt;style&gt; ' +
		':host::shadow span { color: red; }' + 
	'&lt;/style&gt; ' +

	"&lt;span&gt;  Shadow DOM &lt;span&gt; " +
	'&lt;content&gt;&lt;/content&gt;   ';
</pre>
Il risultato restituito sarà il seguente:
</p>

<div id="host">
	<p>paragrafo</p>
	<span>Light DOM</span>
</div>

<script type="text/javascript">
var root = document.querySelector('#host').createShadowRoot();

root.innerHTML = 
	'<style>' +
		':host::shadow span { color: red; }' + 
	'</style>' +

	"<span>Shadow DOM</span>" +
	'<content></content>';
</script>


<h2>/deep/</h2>
<p>
Il combinatore <q>/deep/</q> è simile a <q>::shadow</q> ma più potente. 

<pre>
<span class="azzurro">
&lt;x-tabs&gt;
	&lt;x-panel&gt;Sono parte dell'elemento x-panel&lt;/x-panel&gt; 
&lt;/x-tabs&gt;  
</span>
&lt;script&gt; 
var root = document.querySelector('x-tabs').createShadowRoot();
root.innerHTML = 
	'&lt;style&gt; ' +
		'x-tabs /deep/ x-panel { color: red; }' + 
	'&lt;/style&gt; ' +

	'&lt;content&gt;&lt;/content&gt;  ';
&lt;script&gt; 
</pre>
In questo caso fa riferimento agli elementi &lt;x-panel&gt; che sono discendenti di &lt;x-tabs&gt;. Pertanto avremo il seguente:  
</p>

<x-tabs>
	<x-panel>Sono parte dell'elemento x-panel</x-panel>
</x-tabs>

<script type="text/javascript">
var root = document.querySelector('x-tabs').createShadowRoot();
root.innerHTML = 
	'<style>' +
		'x-tabs /deep/ x-panel { color: red; }' + 
	'</style>' +
	'<content></content>';
</script>

<p>
Mentre nel seguente esempio farà riferimento a tutti gli elementi di classe 'library-theme' che sono discendenti del &lt;body&gt;
<pre>
body /deep/ .library-theme {
  ...
}
</pre> 
</p>


<h2>::content</h2>
<p>
I cosidetti <q>nodi distribuiti</q> (distributed nodes) sono nodi-figli dell'elemento host. Per poter arrivare ad essi ci viene incontro lo pseudo elemento <q>::content</q>.

<pre>
<span class="azzurro">
&lt;div&gt; 
	&lt;h3&gt;Light DOM&lt;/h3&gt;  
	&lt;section&gt; 
		&lt;div&gt;I'm not underlined&lt;/div&gt;  
		&lt;p&gt;I'm underlined in Shadow DOM!&lt;/p&gt;  
	&lt;/section&gt;  

&lt;/div&gt; 
</span>
&lt;script&gt; 
var div = document.querySelector('div');
var root = div.createShadowRoot();
root.innerHTML = 
	'&lt;style&gt;' +
		'h3 { color: red; }' +
		'content[select="h3"]::content > h3 {color: green; }' +
		'::content section p { text-decoration: underline;  }' +      
	'&lt;style&gt;' +

	'&lt;h3&gt; Shadow DOM &lt;/h3&gt;' +
	'&lt;content select="h3"&gt;&lt;/content&gt;' +     
	'&lt;content select="section"&gt;&lt;/content&gt;' +     
&lt;/script&gt; 
</pre>
Si avrebbe il seguente risultato
</p>

<div id='divvo'>
  <h3>Light DOM</h3>
  <section>
    <div>I'm not underlined</div>
    <p>I'm underlined in Shadow DOM!</p>
  </section>
</div>

<script type="text/javascript">

var div = document.querySelector('#divvo');
var root = div.createShadowRoot();
root.innerHTML = 
	'<style>' +
		'h3 { color: red; }' +
		'content[select="h3"]::content > h3 { color: green; }' +
		'::content section p { text-decoration: underline; }' +
	'</style>' +	
	'<h3>Shadow DOM</h3>' +
	'<content select="h3"></content>' + 
	'<content select="section"></content>';

</script>


<h2>Utilizzo di molteplici shadow roots </h2>

<p>
Nel seguente esempio
<pre>
<span class="azzurro">
&lt;div id="example1"&gt;Light DOM&lt;/div&gt; 
</span>
&lt;script&gt; 
var container = document.querySelector('#example1');
var root1 = container.createShadowRoot();
var root2 = container.createShadowRoot();
root1.innerHTML = '&lt;div&gt;Root 1 FTW &lt;/div&gt;';
root2.innerHTML = '&lt;div&gt;Root 2 FTW &lt;/div&gt;';
&lt;/script&gt; 
</pre>
avremo il seguente risultato:
<div id="example1">Light DOM</div>

<script type="text/javascript">
var container = document.querySelector('#example1');
var root1 = container.createShadowRoot();
var root2 = container.createShadowRoot();
root1.innerHTML = '<div>Root 1 FTW</div>';
root2.innerHTML = '<div>Root 2 FTW</div>';
</script>
Da questo notiamo che solo l'ultimo shadow tree attaccato viene restituito prevalendo su tutti gli altri. Questo shadow tree è detto <q>young tree</q> (l'albero giovane) proprio perchè è l'ultimo arrivato mentre i precedenti e in questo caso il precedente (trattandosi soltanto di uno) vengono chiamati <q>older trees</q>. <br />
Certamente c'è il modo di mostrare tutti gli shadow trees e questo si ottiene con gli <tt>Shadow Insertion Points</tt> (shadow). Essi sono dei segnaposto per gli shadow trees. Vediamo come utilizzarli:
<pre>
<span class="azzurro">
&lt;div id="example2"&gt;Light DOM&lt;/div&gt; 
</span>
&lt;script&gt; 
var container = document.querySelector('#example2');
var root1 = container.createShadowRoot();
var root2 = container.createShadowRoot();
var root3 = container.createShadowRoot();
root1.innerHTML = '&lt;div&gt;Root 1 FTW&lt;/div&gt; &lt;content&gt;&lt;/content&gt;';			<span class="nota">il tag content permette di visualizzare 'Light DOM'</span>
root2.innerHTML = '&lt;div&gt;Root 2 FTW &lt;/div&gt; &lt;shadow&gt;&lt;/shadow&gt;';			<span class="nota">il tag shadow permette di visualizzare 'Root 1 FTW' </span>
root3.innerHTML = '&lt;div&gt;Root 2 FTW &lt;/div&gt; &lt;shadow&gt;&lt;/shadow&gt;';			

&lt;/script&gt; 
</pre>
Il risultato che si avrà sarà il seguente
</p>

<div id="example2">Light DOM</div>

<script type="text/javascript">
var container = document.querySelector('#example2');
var root1 = container.createShadowRoot();
var root2 = container.createShadowRoot();
var root3 = container.createShadowRoot();
root1.innerHTML = '<div>Root 1 FTW</div><content></content>';
root2.innerHTML = '<div>Root 2 FTW</div><shadow></shadow>';
root3.innerHTML = '<div>Root 3 FTW</div><shadow></shadow>';
</script>

<p>
Se si vuole che il &lt;div&gt;Root 1 FTW &lt;/div&gt; appaia per primo allora bisogna solo cambiare la posizione dello <tt>shadow</tt>  
<pre>
root2.innerHTML = '&lt;shadow&gt;&lt;/shadow&gt; &lt;div&gt;Root 2 FTW &lt;/div&gt; ';
root3.innerHTML = '&lt;shadow&gt;&lt;/shadow&gt; &lt;div&gt;Root 3 FTW &lt;/div&gt; ';
</pre>
</p>

<h3>Ottenere lo shadow root</h3>
<p>
E' possibile ottenere l'ultima shadow tree con il metodo <tt>.shadowRoot</tt> 
<pre>
var root = host.createShadowRoot();
console.log(host.shadowRoot === root);					<span class="nota">// true</span> 
console.log(document.body.shadowRoot);					<span class="nota">// null</span>
</pre>
</p>

<h3>Creare lo shadow dom con Javascript</h3>

<pre>
<span class="azzurro">
&lt;div id="example3"&gt; 
	&lt;span&gt;Light DOM&lt;/span&gt; 
&lt;/div&gt; 
</span>
&lt;script&gt; 

var container = document.querySelector('#example3');
var root1 = container.createShadowRoot();
var root2 = container.createShadowRoot();

var div = document.createElement('div');
div.textContent = 'Root 1 FTW';
root1.appendChild(div);

var content = document.createElement('content');
content.select = 'span';				<span class="nota">seleziona tutti gli elementi &lt;span&gt; che il nodo host contiene </span>
root1.appendChild(content);

var div = document.createElement('div');
div.textContent = 'Root 2 FTW';
root2.appendChild(div);

var shadow = document.createElement('shadow');
root2.appendChild(shadow);

&lt;/script&gt; 
</pre>


<h2>Element.getDistributedNodes()</h2>
<p>

</p>



<h2>Element.getDestinationInsertionPoints()</h2>











<script type="text/javascript">


/*
var XFooProto = Object.create(HTMLElement.prototype);

XFooProto.createdCallback = function() {
	var shadow = this.createShadowRoot();

	shadow.innerHTML = "<b>I'm in the element's Shadow DOM!</b>";
};

var XFoo = document.registerElement('x-foo-shadowdom', {prototype: XFooProto});

//document.body.appendChild(XFoo);						// NO
document.body.appendChild(new XFoo());					// OK 
*/
</script>












<br /><br /><br /><br /><br /><br />



</body>
</html>
